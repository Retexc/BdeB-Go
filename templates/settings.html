<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Paramètres</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" 
          integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" 
          crossorigin="anonymous">
    <link rel="stylesheet" href="../static/settings.css">
    <link rel="icon" href="../static/assets/icons/icon.ico">
  </head>
  <body>
    <div class="d-flex">
      <!-- Sidebar -->
      <div class="sidebar">
        <img class="logo" src="../static/assets/images/logo-menu.svg" alt="Bdeblogo">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link active d-flex align-items-center" href="/#">
              <img src="../static/assets/images/home.svg" alt="Home" style="width:30px; height:30px; margin-right:10px;">
              <span>Accueil</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active d-flex align-items-center" href="/admin/background">
              <img src="../static/assets/images/background.svg" alt="Fond_ecran" style="width:30px; height:30px; margin-right:10px;">
              <span>Fond d’écran</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active d-flex align-items-center" href="/admin/settings">
              <img src="../static/assets/images/settings.svg" alt="Parametres" style="width:30px; height:30px; margin-right:10px;">
              <span>Paramètres</span>
            </a>
          </li>  
          <li class="nav-item">
            <a class="nav-link d-flex align-items-center text-danger" href="/admin/logout">
              <img src="../static/assets/icons/logout.svg"
                   alt="Déconnexion"
                   style="width:30px; height:30px; margin-right:10px;">
              <span>Déconnexion</span>
            </a>
          </li>
        </ul>
        
    </div>


      <!-- Main Content -->
      <div class="main-content">
        <div class="container py-4">
          <div class="page-header mb-4">
            <div class="container py-4">
              {# ← Flash messages go here #}
              {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                  <div class="mb-4">
                    {% for category, msg in messages %}
                      <div class="alert alert-{{ category }} py-2">
                        {{ msg }}
                      </div>
                    {% endfor %}
                  </div>
                {% endif %}
              {% endwith %}
            <h1 class="Title">Paramètres</h1>
          </div>

          <!-- TABS NAVIGATION -->
          <ul class="nav settings-nav mb-4">
            <li class="nav-item">
              <a class="nav-link active" data-bs-toggle="tab" href="#gtfs">GTFS</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-bs-toggle="tab" href="#update">Mise à jour</a>
            </li>
          </ul>

          <!-- TABS CONTENT -->
          <div class="tab-content">
            <div id="gtfs" class="tab-pane fade show active">
              <!-- Intro Card -->
              <div class="card bg-dark text-white rounded mb-4 p-3">
                <p class="mb-2">
                  Les fichiers GTFS contiennent les horaires et les informations des autobus et des trains Exo.  
                  Il est nécessaire de les mettre à jour régulièrement.
                </p>
                <p class="mb-2">
                  Vous pouvez utiliser les dates disponibles sur le site de la STM comme référence pour mettre à jour les fichiers.
                </p>
                <p class="mb-2">
                  Pour télécharger les dernières versions des données GTFS, consultez :
                </p>
                <ul class="ps-3 mb-0">
                  <li>
                    <a href="https://www.stm.info/fr/a-propos/developpeurs" target="_blank" class="text-white">
                      STM : Développeurs | Société de transport de Montréal
                    </a>
                  </li>
                  <li>
                    <a href="https://exo.quebec/fr/a-propos/donnees-ouvertes" target="_blank" class="text-white">
                      Exo : Autobus, trains et transport adapté dans la région de Montréal
                    </a>
                  </li>
                </ul>
              </div>
            
              <!-- STM Section -->
              <form action="/admin/update_gtfs" method="post" enctype="multipart/form-data">
                <div class="gtfs-section d-flex flex-column align-items-start mb-5">
                  <img src="../static/assets/images/stm_logo.svg" alt="STM logo" class="gtfs-logo mb-3">
                  <div class="d-flex align-items-center w-100">
                    <input type="hidden" name="transport" value="stm">
                    <label for="stmFile" class="form-label text-white mb-0 me-2">
                      Fichier GTFS (ZIP) :
                    </label>
                    <input
                      type="file"
                      id="stmFile"
                      name="gtfs_zip"
                      accept=".zip"
                      class="form-control form-control-sm me-2 stm-input"
                      required
                    />
                    <button type="submit" class="btn btn-warning btn-sm me-3">
                      Importer
                    </button>
                    <div class="text-white small">
                      Dernière mise à jour :
                      <span id="stmLastUpdate">{{ update_info.stm or "N/A" }}</span>
                    </div>
                  </div>
                </div>
              </form>
              
            
              <form action="/admin/update_gtfs" method="post" enctype="multipart/form-data">
                <div class="gtfs-section d-flex flex-column align-items-start mb-5">
                  <img src="../static/assets/images/exo.svg" alt="Exo logo" class="gtfs-logo mb-3">
                  <div class="d-flex align-items-center w-100">
                    <input type="hidden" name="transport" value="exo">
            
                    <label for="exoFile" class="form-label text-white mb-0 me-2">
                      Fichier GTFS (ZIP) :
                    </label>
                    <input
                      type="file"
                      id="exoFile"
                      name="gtfs_zip"
                      accept=".zip"
                      class="form-control form-control-sm me-2 exo-input"
                      required
                    />
                    <button type="submit" class="btn btn-warning btn-sm me-3">
                      Importer
                    </button>
                    <div class="text-white small">
                      Dernière mise à jour :
                      <span id="exoLastUpdate">{{ update_info.exo or "N/A" }}</span>
                    </div>
                  </div>
                </div>
              </form>
            </div>
            
            <div id="update" class="tab-pane fade">
              {% if update_available %}
                <!-- update available panel -->
                <div class="update-panel d-flex align-items-center p-4 mb-4">
                  <div class="update-icon warning me-3">!</div>
                  <div class="update-text flex-grow-1">
                    <h4>Mise à jour disponible !</h4>
                    <p>Dernière vérification : {{ last_checked }}</p>
                  </div>
                  <form action="/admin/app_update" method="post">
                    <button class="btn btn-warning">Mettre à jour</button>
                  </form>
                </div>
              {% else %}
                <!-- already up to date panel -->
                <div class="update-panel d-flex align-items-center p-4 mb-4">
                  <div class="update-icon success me-3">✓</div>
                  <div class="update-text flex-grow-1">
                    <h4>Tout est à jour !</h4>
                    <p>Dernière vérification : {{ last_checked }}</p>
                  </div>
                  <form action="/admin/app_update" method="post">
                    <button class="btn btn-warning">Rechercher des mises à jour</button>
                  </form>
                </div>
              {% endif %}
              <div class="auto-update-panel">
                <h5>Auto‑mise à jour</h5>
                <form action="/admin/auto_update_settings" method="post">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="autoEnabled"
                           name="enabled" {{ 'checked' if auto_cfg.enabled }}>
                    <label class="form-check-label" for="autoEnabled">
                      Activer la mise à jour automatique
                    </label>
                  </div>
                  <input type="time" id="autoTime" name="time" value="{{ auto_cfg.time }}">
                  <button type="submit" class="btn btn-primary">Enregistrer</button>
                </form>
              </div>
              
            </div>
            
              
          </div>
        </div>
      </div>
    </div>
          </div>
        </div>
      </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" 
            crossorigin="anonymous"></script>
  </body>
</html>
